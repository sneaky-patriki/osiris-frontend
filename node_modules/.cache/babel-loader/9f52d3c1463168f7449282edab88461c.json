{"ast":null,"code":"var _jsxFileName = \"/Users/nicholaspatrikeos/Sites/Gallifrey4.0/gallifrey-frontend/src/components/ViewCourse.js\";\nimport React from 'react';\nimport axios from 'axios';\nimport { Link } from 'react-router-dom';\nimport '../App.css';\nimport AuthContext from '../AuthContext';\nimport { useStep } from '../utils/update';\nimport { Converter } from 'showdown';\nimport ReactHTMLParser from 'react-html-parser';\n\nfunction ViewCourse({\n  course_id,\n  user_type\n}, ...props) {\n  const [course, setCourse] = React.useState({\n    course_id: 0,\n    name: \"\",\n    modules: []\n  });\n  const [currentTopic, setCurrentTopic] = React.useState({\n    topic_id: 0,\n    module_id: 0,\n    module_name: '',\n    taskgroups: []\n  });\n  const [currentTask, setCurrentTask] = React.useState({\n    task_id: 0,\n    taskgroup: \"\",\n    name: \"\",\n    difficulty: \"\",\n    description: \"\",\n    hint: \"\",\n    solution: \"\",\n    attachments: []\n  });\n  const [submissions, setSubmissions] = React.useState([]); // var [submissionsFetched, setSubmissionsFetched] = React.useState(false)\n\n  const token = React.useContext(AuthContext);\n  var file;\n\n  const fetchCourseData = () => {\n    const getCourse = axios.get('/courses/details', {\n      params: {\n        token,\n        course_id\n      }\n    }).then(courseResponse => {\n      const courseData = courseResponse.data.course;\n      console.log(courseData);\n      setCourse(courseData);\n    }).catch(err => {});\n  };\n\n  const fetchSubmissionData = () => {\n    const task_id = currentTask.task_id;\n    const getSubmissions = axios.get('/courses/submissions', {\n      params: {\n        token,\n        course_id\n      }\n    }).then(submissionsResponse => {\n      const submissionData = submissionsResponse.data.submissions;\n      console.log(submissionData);\n      setSubmissions(submissionData);\n    }).catch(err => {});\n  };\n\n  function getTopic(module_id) {\n    for (var t = 0; t < course.modules.length; t++) {\n      if (course.modules[t].module_id == module_id) {\n        return course.modules[t];\n      }\n    }\n  }\n\n  function getTask(module_id, taskgroup_id, task_id) {\n    for (var t = 0; t < course.modules.length; t++) {\n      if (course.modules[t].module_id == module_id) {\n        for (var tg = 0; tg < course.modules[t].taskgroups.length; tg++) {\n          if (course.modules[t].taskgroups[tg].taskgroup_id == taskgroup_id) {\n            for (var tk = 0; tk < course.modules[t].taskgroups[tg].tasks.length; tk++) {\n              if (course.modules[t].taskgroups[tg].tasks[tk].task_id == task_id) {\n                return course.modules[t].taskgroups[tg].tasks[tk];\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  function showTopic(module_id) {\n    var element = document.getElementById('md' + module_id);\n    element.style.borderTop = '1px solid lightgray';\n    element.style.borderLeft = '1px solid lightgray';\n    element.style.borderRight = '1px solid lightgray';\n    var topic = getTopic(module_id);\n    setCurrentTopic(topic);\n  }\n\n  function displayTaskgroup(taskgroup_id) {\n    var element = document.getElementById('tg' + taskgroup_id);\n    var elements = element.childNodes;\n    console.log(element.name);\n\n    if (element.name == 'undisplayed' || element.name == undefined) {\n      for (var e = 1; e < elements.length; e++) {\n        elements[e].style.display = 'block';\n        console.log(elements[e].style.display);\n      }\n\n      element.name = 'displayed';\n    } else if (element.name == 'displayed') {\n      for (var e = 1; e < elements.length; e++) {\n        elements[e].style.display = 'none';\n      }\n\n      element.name = 'undisplayed';\n    }\n  }\n\n  function displayTask(module_id, taskgroup_id, task_id) {\n    var task = getTask(module_id, taskgroup_id, task_id);\n    console.log(task);\n    setCurrentTask(task);\n  }\n\n  function showHint() {\n    document.getElementById('hint').innerHTML = converter.makeHtml(currentTask.hint);\n  }\n\n  function setFile(event) {\n    file = event.target.files[0];\n  }\n\n  function handleSubmit(event) {\n    event.preventDefault();\n\n    if (!file) {\n      console.log('No file chosen');\n      return;\n    }\n\n    var form = new FormData();\n    form.append('token', token);\n    form.append('task_id', currentTask.task_id);\n    form.append('file', file);\n    axios.post('/tasks/submit', form, {\n      headers: {\n        'content-type': 'multipart/form-data'\n      }\n    }).then(response => {\n      const data = response.data;\n      console.log(data);\n      window.location.reload();\n    }).catch(err => {});\n  }\n\n  function taskSubmissions() {\n    var subs = [];\n\n    for (var sb = 0; sb < submissions.length; sb++) {\n      if (submissions[sb].task == currentTask.task_id) {\n        subs.push(submissions[sb]);\n      }\n    }\n\n    return subs;\n  }\n\n  function taskSubmissionState(task_id) {\n    var subs = [];\n\n    for (var sb = 0; sb < submissions.length; sb++) {\n      if (submissions[sb].task == task_id) {\n        subs.push(submissions[sb]);\n      }\n    }\n\n    return subs[subs.length - 1].status;\n  }\n\n  const step1 = useStep(fetchCourseData, [], 2);\n  const step2 = useStep(fetchSubmissionData, [], 2);\n  var converter = new Converter();\n  var hint;\n\n  if (currentTask.hint) {\n    hint = /*#__PURE__*/React.createElement(\"div\", {\n      className: \"teacherButton\",\n      id: \"hint\",\n      name: \"hintHide\",\n      onClick: () => showHint(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 7\n      }\n    }, \"Show Hint\");\n  } else {\n    hint = /*#__PURE__*/React.createElement(React.Fragment, null);\n  }\n\n  var submissionBlock;\n\n  if (user_type == 'student' && currentTask.task_id != 0) {\n    const taskSubs = taskSubmissions();\n    console.log(taskSubs);\n    var existingSubmissions;\n\n    if (taskSubs.length > 0) {\n      existingSubmissions = /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 11\n        }\n      }, \"Submissions\"), taskSubs.map(({\n        time,\n        status,\n        url,\n        comment\n      }, index) => /*#__PURE__*/React.createElement(\"div\", {\n        className: \"submissionDisplay\",\n        name: status,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 13\n        }\n      }, comment, /*#__PURE__*/React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 15\n        }\n      }, status), \" \", /*#__PURE__*/React.createElement(\"a\", {\n        href: url,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 41\n        }\n      }, \"Download\"))));\n    } else {\n      existingSubmissions = /*#__PURE__*/React.createElement(React.Fragment, null);\n    }\n\n    submissionBlock = /*#__PURE__*/React.createElement(\"div\", {\n      className: \"submissionBox\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }\n    }, \"Submit Your Solution\"), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 9\n      }\n    }, \"Files\"), /*#__PURE__*/React.createElement(\"form\", {\n      name: \"submit_task_form\",\n      onSubmit: handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"file\",\n      name: \"submission\",\n      onChange: setFile,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 69\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"Submit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 11\n      }\n    })));\n  } else {\n    submissionBlock = /*#__PURE__*/React.createElement(React.Fragment, null);\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    id: \"courseName\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 11\n    }\n  }, course.name)), /*#__PURE__*/React.createElement(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"table\", {\n    id: \"topicProgress\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 9\n    }\n  }, course.modules.map(({\n    module_name\n  }, index) => /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 11\n    }\n  }, module_name))), /*#__PURE__*/React.createElement(\"tr\", {\n    id: \"progressDashRow\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"topicTabs\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 7\n    }\n  }, course.modules.map(({\n    module_id,\n    module_name,\n    topic_id\n  }, index) => /*#__PURE__*/React.createElement(\"div\", {\n    class: \"topicTab\",\n    id: \"md\" + module_id,\n    onClick: () => showTopic(module_id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 9\n    }\n  }, module_name))), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"taskGroupBox\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"taskgroupList\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 11\n    }\n  }, currentTopic.taskgroups.map(({\n    taskgroup_id,\n    name,\n    tasks\n  }, index) => /*#__PURE__*/React.createElement(\"span\", {\n    className: \"taskGroupList\",\n    name: \"undisplayed\",\n    id: \"tg\" + taskgroup_id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"taskGroupName\",\n    onClick: () => displayTaskgroup(taskgroup_id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 15\n    }\n  }, name), tasks.map(({\n    task_id,\n    name,\n    difficulty\n  }, index) => /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n    style: {\n      display: 'none'\n    },\n    id: \"tk\" + task_id,\n    onClick: () => displayTask(currentTopic.module_id, taskgroup_id, task_id),\n    className: difficulty,\n    name: submissionState(task_id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 19\n    }\n  }, name)))))), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"taskBox\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 15\n    }\n  }, currentTask.name), ReactHTMLParser(converter.makeHtml(currentTask.description))), hint, /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 11\n    }\n  }), submissionBlock, existingSubmissions)));\n}\n\nexport default ViewCourse;","map":{"version":3,"sources":["/Users/nicholaspatrikeos/Sites/Gallifrey4.0/gallifrey-frontend/src/components/ViewCourse.js"],"names":["React","axios","Link","AuthContext","useStep","Converter","ReactHTMLParser","ViewCourse","course_id","user_type","props","course","setCourse","useState","name","modules","currentTopic","setCurrentTopic","topic_id","module_id","module_name","taskgroups","currentTask","setCurrentTask","task_id","taskgroup","difficulty","description","hint","solution","attachments","submissions","setSubmissions","token","useContext","file","fetchCourseData","getCourse","get","params","then","courseResponse","courseData","data","console","log","catch","err","fetchSubmissionData","getSubmissions","submissionsResponse","submissionData","getTopic","t","length","getTask","taskgroup_id","tg","tk","tasks","showTopic","element","document","getElementById","style","borderTop","borderLeft","borderRight","topic","displayTaskgroup","elements","childNodes","undefined","e","display","displayTask","task","showHint","innerHTML","converter","makeHtml","setFile","event","target","files","handleSubmit","preventDefault","form","FormData","append","post","headers","response","window","location","reload","taskSubmissions","subs","sb","push","taskSubmissionState","status","step1","step2","submissionBlock","taskSubs","existingSubmissions","map","time","url","comment","index","submissionState"],"mappings":"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","sourcesContent":["import React from 'react'\nimport axios from 'axios'\nimport { Link } from 'react-router-dom'\nimport '../App.css'\nimport AuthContext from '../AuthContext'\nimport { useStep } from '../utils/update'\nimport { Converter } from 'showdown'\nimport ReactHTMLParser from 'react-html-parser'\n\nfunction ViewCourse({ course_id, user_type }, ...props) {\n\n  const [course, setCourse] = React.useState({\n    course_id: 0,\n    name: \"\",\n    modules: []\n  })\n  const [currentTopic, setCurrentTopic] = React.useState({\n    topic_id: 0,\n    module_id: 0,\n    module_name: '',\n    taskgroups: [],\n  })\n  const [currentTask, setCurrentTask] = React.useState({\n    task_id: 0,\n    taskgroup: \"\",\n    name: \"\",\n    difficulty: \"\",\n    description: \"\",\n    hint: \"\",\n    solution: \"\",\n    attachments: []\n  })\n  const [submissions, setSubmissions] = React.useState([])\n  // var [submissionsFetched, setSubmissionsFetched] = React.useState(false)\n\n  const token = React.useContext(AuthContext)\n  var file;\n\n  const fetchCourseData = () => {\n    const getCourse = axios.get('/courses/details', {params: { token, course_id }})\n      .then((courseResponse) => {\n        const courseData = courseResponse.data.course\n        console.log(courseData)\n        setCourse(courseData)\n      })\n      .catch((err) => {})\n  }\n\n  const fetchSubmissionData = () => {\n    const task_id = currentTask.task_id\n    const getSubmissions = axios.get('/courses/submissions', {params: { token, course_id }})\n      .then((submissionsResponse) => {\n        const submissionData = submissionsResponse.data.submissions\n        console.log(submissionData)\n        setSubmissions(submissionData)\n      })\n      .catch((err) => {})\n  }\n\n  function getTopic(module_id) {\n    for (var t = 0; t < course.modules.length; t++) {\n      if (course.modules[t].module_id == module_id) {\n        return course.modules[t]\n      }\n    }\n  }\n\n  function getTask(module_id, taskgroup_id, task_id) {\n    for (var t = 0; t < course.modules.length; t++) {\n      if (course.modules[t].module_id == module_id) {\n        for (var tg = 0; tg < course.modules[t].taskgroups.length; tg++) {\n          if (course.modules[t].taskgroups[tg].taskgroup_id == taskgroup_id) {\n            for (var tk = 0; tk < course.modules[t].taskgroups[tg].tasks.length; tk++) {\n              if (course.modules[t].taskgroups[tg].tasks[tk].task_id == task_id) {\n                return course.modules[t].taskgroups[tg].tasks[tk]\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  function showTopic(module_id) {\n    var element = document.getElementById('md' + module_id)\n    element.style.borderTop = '1px solid lightgray'\n    element.style.borderLeft = '1px solid lightgray'\n    element.style.borderRight = '1px solid lightgray'\n\n    var topic = getTopic(module_id)\n\n    setCurrentTopic(topic)\n  }\n\n  function displayTaskgroup(taskgroup_id) {\n    var element = document.getElementById('tg' + taskgroup_id)\n    var elements = element.childNodes\n\n    console.log(element.name)\n\n    if (element.name == 'undisplayed' || element.name == undefined) {\n      for (var e = 1; e < elements.length; e++) {\n        elements[e].style.display = 'block'\n        console.log(elements[e].style.display)\n      }\n      element.name = 'displayed'\n\n    } else if (element.name == 'displayed') {\n      for (var e = 1; e < elements.length; e++) {\n        elements[e].style.display = 'none'\n      }\n      element.name = 'undisplayed'\n    }\n  }\n\n  function displayTask(module_id, taskgroup_id, task_id) {\n    var task = getTask(module_id, taskgroup_id, task_id)\n    console.log(task)\n    setCurrentTask(task)\n  }\n\n  function showHint() {\n    document.getElementById('hint').innerHTML = converter.makeHtml(currentTask.hint)\n  }\n\n  function setFile(event) {\n    file = event.target.files[0]\n  }\n\n  function handleSubmit(event) {\n    event.preventDefault()\n\n    if (!file) {\n      console.log('No file chosen')\n      return\n    }\n\n    var form = new FormData()\n    form.append('token', token)\n    form.append('task_id', currentTask.task_id)\n    form.append('file', file)\n\n    axios.post('/tasks/submit', form, { headers: { 'content-type': 'multipart/form-data' }})\n      .then((response) => {\n        const data = response.data\n        console.log(data)\n        window.location.reload()\n      })\n      .catch((err) => {})\n  }\n\n  function taskSubmissions() {\n    var subs = []\n    for (var sb = 0; sb < submissions.length; sb++) {\n      if (submissions[sb].task == currentTask.task_id) {\n        subs.push(submissions[sb])\n      }\n    }\n    return subs\n  }\n\n  function taskSubmissionState(task_id) {\n    var subs = []\n    for (var sb = 0; sb < submissions.length; sb++) {\n      if (submissions[sb].task == task_id) {\n        subs.push(submissions[sb])\n      }\n    }\n    return subs[subs.length - 1].status\n  }\n\n  const step1 = useStep(fetchCourseData, [], 2)\n  const step2 = useStep(fetchSubmissionData, [], 2)\n\n  var converter = new Converter()\n\n  var hint;\n  if (currentTask.hint) {\n    hint = (\n      <div className='teacherButton' id='hint' name='hintHide' onClick={() => showHint()}>Show Hint</div>\n    )\n  } else {\n    hint = <></>\n  }\n\n  var submissionBlock;\n  if (user_type == 'student' && currentTask.task_id != 0) {\n\n    const taskSubs = taskSubmissions()\n    console.log(taskSubs)\n    var existingSubmissions;\n\n    if (taskSubs.length > 0) {\n      existingSubmissions = (\n        <>\n          <h4>Submissions</h4>\n          {taskSubs.map(({ time, status, url, comment }, index) => (\n            <div className='submissionDisplay' name={status}>{comment}\n              <strong>{status}</strong> <a href={url}>Download</a>\n            </div>\n          ))}\n        </>\n      )\n    } else {\n      existingSubmissions = <></>\n    }\n\n    submissionBlock = (\n      <div className='submissionBox'>\n        <h4>Submit Your Solution</h4>\n        <hr/>\n        <p>Files</p>\n        <form name='submit_task_form' onSubmit={handleSubmit}>\n          <input type='file' name='submission' onChange={setFile} /><br/>\n          <input type='submit' value='Submit'/>\n        </form>\n      </div>\n\n    )\n  } else {\n    submissionBlock = <></>\n  }\n\n  return (\n    <>\n      <div>\n          <h1 id='courseName'>{course.name}</h1>\n      </div>\n\n      <hr/>\n\n      <table id='topicProgress'>\n        <tr>\n        {course.modules.map(({ module_name }, index) => (\n          <td>{module_name}</td>\n        ))}\n        </tr>\n        <tr id='progressDashRow'>\n\n        </tr>\n\n      </table>\n\n      <div id='topicTabs'>\n      {course.modules.map(({ module_id, module_name, topic_id }, index) => (\n        <div class='topicTab' id={\"md\" + module_id} onClick={() => showTopic(module_id)}>\n          {module_name}\n        </div>\n      ))}\n      </div>\n\n      <div id=\"taskGroupBox\">\n          <div id='taskgroupList'>\n          {currentTopic.taskgroups.map(({ taskgroup_id, name, tasks }, index) => (\n            <span className='taskGroupList' name='undisplayed' id={\"tg\" + taskgroup_id}>\n              <span className='taskGroupName' onClick={() => displayTaskgroup(taskgroup_id)}>\n              {name}\n              </span>\n              {tasks.map(({ task_id, name, difficulty }, index) => (\n                <>\n                  <span style={{display: 'none'}} id={\"tk\" + task_id} onClick={() => displayTask(currentTopic.module_id, taskgroup_id, task_id)}\n                  className={difficulty} name={submissionState(task_id)}>{name}</span>\n                </>\n              ))}\n            </span>\n          ))}\n          </div>\n\n          <div id='taskBox'>\n          {\n            <>\n              <h1>{currentTask.name}</h1>\n              {ReactHTMLParser(converter.makeHtml(currentTask.description))}\n\n            </>\n          }\n          {hint}\n          <br/>\n          <br/>\n          {submissionBlock}\n          {existingSubmissions}\n          </div>\n      </div>\n    </>\n  )\n\n}\n\nexport default ViewCourse\n"]},"metadata":{},"sourceType":"module"}